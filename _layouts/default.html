<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
 
<title>{{ page.title }}</title>
<link rel="shortcut icon" type="image/x-icon" href="{{ '/Images/icon/favicon.ico' | relative_url }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ '/Images/icon/favicon-32x32.png' | relative_url }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ '/Images/icon/favicon-16x16.png' | relative_url }}">
<link rel="apple-touch-icon" sizes="180x180" href="{{ '/Images/icon/apple-touch-icon.png' | relative_url }}">
<link rel="manifest" href="{{ '/Images/icon/site.webmanifest' | relative_url }}">
 
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono&display=swap" rel="stylesheet">

<script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
 
<style>
  /* --- 0. ÂÖ®Â±ÄËÆæÁΩÆ --- */
  .github-only { display: none !important; }
  .lang-zh { display: none; animation: fadeIn 0.5s ease; }
  .lang-en { display: block; animation: fadeIn 0.5s ease; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
   
  body { 
    margin: 0; padding: 0; color: #e0e7ff; 
    font-family: 'Inter', -apple-system, sans-serif; 
    line-height: 1.6; overflow-x: hidden; 
    cursor: none; 
    scrollbar-width: thin; scrollbar-color: #3b82f6 transparent;
    transition: color 0.5s ease;
    background-color: #0a0a0f; 
  }
  @media (pointer: coarse) { body { cursor: auto; } }
 
  /* ‚ö°Ô∏è CSS ÊÄßËÉΩ‰ºòÂåñ */
  img, video, iframe, model-viewer { 
      max-width: 100% !important; 
      height: auto !important; 
      box-sizing: border-box; 
      content-visibility: auto; 
      transition: opacity 0.5s ease;
  }
 
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: rgba(59, 130, 246, 0.5); border-radius: 10px; }
  ::-webkit-scrollbar-thumb:hover { background: rgba(59, 130, 246, 0.8); }
  ::selection { background: #3b82f6; color: #ffffff; text-shadow: 0 0 8px rgba(255, 255, 255, 0.8); }
 
  /* --- 1. ÂÖâÊ†á & ËøõÂ∫¶Êù° --- */
  .cursor-dot, .cursor-outline {
    position: fixed; top: 0; left: 0; 
    transform: translate(-50%, -50%); border-radius: 50%; z-index: 99999; pointer-events: none;
    transition: opacity 0.2s ease, width 0.2s, height 0.2s, background-color 0.2s;
  }
  .cursor-dot { width: 8px; height: 8px; background-color: #3b82f6; }
  .cursor-outline { width: 40px; height: 40px; border: 1px solid rgba(59, 130, 246, 0.5); }
  body.hovering .cursor-outline { width: 60px; height: 60px; background-color: rgba(59, 130, 246, 0.1); border-color: transparent; }
  #progress-bar { position: fixed; top: 0; left: 0; height: 3px; background: linear-gradient(90deg, #3b82f6, #60a5fa); width: 0%; z-index: 99999; transition: width 0.1s; }
 
  /* --- 2. ËÉåÊôØ --- */
  #vanta-bg { position: fixed; z-index: -5; top: 0; left: 0; width: 100%; height: 100%; background: #0a0a0f; }
  #vanta-bg::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, transparent 0%, rgba(10, 10, 15, 0.4) 100%); pointer-events: none; transition: background 0.5s ease; }
 
  #meteor-canvas {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: -4; pointer-events: none; 
  }
   
  /* --- 3. Â∏ÉÂ±Ä --- */
  .layout-wrapper { position: relative; max-width: 860px; margin: 100px auto 60px; z-index: 10; perspective: 1000px; }
 
  /* --- 4. Êú∫Âô®‰∫∫Ê†∏ÂøÉ --- */
  #bot-container { 
    position: absolute; top: 70px; left: 50%; 
    transform: translateX(-50%); width: 120px; height: 70px; 
    z-index: 9999; cursor: pointer; 
    opacity: 1; 
    transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); 
  }
  #bot-container.fixed-mode { position: fixed !important; top: auto !important; left: auto !important; bottom: 30px !important; right: 30px !important; transform: scale(0.9) !important; opacity: 1 !important; }
  
  /* --- üî• Êú∫Âô®‰∫∫ÂºïÂØºÊ®°Âºè --- */
  .guide-arrow {
    position: absolute; left: -50px; top: 50%; transform: translateY(-50%);
    font-size: 40px; color: #ef4444; opacity: 0; pointer-events: none;
    text-shadow: 0 0 10px rgba(239, 68, 68, 0.8); transition: opacity 0.3s; z-index: 100; font-weight: bold;
  }
  #bot-container.guide-mode {
    position: fixed !important; top: 50% !important; right: 10% !important; left: auto !important; bottom: auto !important;
    transform: translate(0, -50%) scale(1.2) !important; z-index: 100006 !important;
  }
  #bot-container.guide-mode .guide-arrow { opacity: 1; animation: point-left 0.8s ease-in-out infinite alternate; }
  @keyframes point-left { from { transform: translateY(-50%) translateX(0); } to { transform: translateY(-50%) translateX(-15px); } }

  /* Ë∑≥Âä®Âä®Áîª */
  #bot-container.attention-jump { animation: attention-bounce 0.6s ease infinite alternate; }
  @keyframes attention-bounce { 0% { transform: translateX(-50%) translateY(0) scale(1); } 100% { transform: translateX(-50%) translateY(-15px) scale(1.1); } }
  #bot-container.fixed-mode.attention-jump { animation: attention-bounce-fixed 0.6s ease infinite alternate; }
  @keyframes attention-bounce-fixed { 0% { transform: scale(0.9) translateY(0); } 100% { transform: scale(0.9) translateY(-15px); } }
 
  /* Ê∂üÊº™ÂÖâÂúà */
  .pulse-ring { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100px; height: 100px; border-radius: 50%; border: 2px solid rgba(168, 85, 247, 0.5); opacity: 0; z-index: -1; pointer-events: none; animation: pulse-ring-anim 6s infinite cubic-bezier(0.4, 0, 0.6, 1); transition: opacity 0.5s; }
  #bot-container.speaking .pulse-ring { animation-duration: 1.5s; border-color: rgba(59, 130, 246, 0.8); }
  #bot-container.interaction-done .pulse-ring { opacity: 0 !important; animation: none !important; }
  @keyframes pulse-ring-anim { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; } 30% { opacity: 0.6; } 100% { transform: translate(-50%, -50%) scale(2.5); opacity: 0; } }
 
  .bot-head { width: 100px; height: 50px; background: #ffffff; border: 2px solid #e0e7ff; border-bottom: none; border-radius: 50px 50px 20px 20px; margin: 0 auto; position: relative; box-shadow: 0 -5px 15px rgba(59, 130, 246, 0.15); display: flex; justify-content: center; align-items: center; gap: 10px; padding-top: 5px; animation: float-bot 3s ease-in-out infinite; }
  .bot-eye { width: 28px; height: 28px; background: #bfdbfe; border-radius: 50%; border: 1px solid #93c5fd; position: relative; overflow: hidden; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
  .bot-pupil { width: 14px; height: 14px; background: #1e3a8a; border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); transition: opacity 0.2s; }
  .bot-lid { position: absolute; top: 0; left: 0; width: 100%; height: 0%; background: #ffffff; z-index: 10; animation: blink 4s infinite; }
  #bot-container.speaking .bot-eye { background: transparent; border: none; box-shadow: none; width: 22px; height: 12px; border-top: 3px solid #3b82f6; border-radius: 22px 22px 0 0; margin-top: 8px; }
  #bot-container.speaking .bot-pupil, #bot-container.speaking .bot-lid { opacity: 0; }
  .bot-mouth { position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; background: #3b82f6; border-radius: 4px; opacity: 0; transition: all 0.2s; }
  #bot-container.speaking .bot-mouth { opacity: 1; width: 14px; background: transparent; border: 2px solid #3b82f6; animation: mouth-talk 0.25s infinite alternate; }
  .bot-antenna { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); width: 2px; height: 25px; background: #e0e7ff; }
  .bot-antenna::after { content: ''; position: absolute; top: -6px; left: -3px; width: 8px; height: 8px; border-radius: 50%; animation: pulse-antenna-breath 2s infinite ease-in-out; }
  #bot-speech { position: absolute; top: -45px; left: 50%; transform: translateX(-50%) scale(0); transform-origin: bottom center; background: rgba(30, 41, 59, 0.95); color: #fff; padding: 6px 14px; border-radius: 12px; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; white-space: nowrap; pointer-events: none; border: 1px solid rgba(59, 130, 246, 0.4); box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s; z-index: 10000; opacity: 0; }
  #bot-speech::after { content: ''; position: absolute; bottom: -5px; left: 50%; width: 8px; height: 8px; background: inherit; transform: translateX(-50%) rotate(45deg); border-right: 1px solid rgba(59, 130, 246, 0.4); border-bottom: 1px solid rgba(59, 130, 246, 0.4); }
  #bot-container.speaking #bot-speech { transform: translateX(-50%) scale(1); opacity: 1; }
 
  #rpg-dialogue { position: absolute; top: 65px; left: 50%; transform: translateX(-50%) translateY(20px); width: 600px; max-width: 90vw; background: rgba(15, 23, 42, 0.95); border: 1px solid #3b82f6; border-radius: 12px; padding: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.6), 0 0 15px rgba(59, 130, 246, 0.2); z-index: 20000; opacity: 0; pointer-events: none; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; gap: 10px; font-family: 'JetBrains Mono', monospace; }
  #rpg-dialogue.active { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }
  #bot-container.fixed-mode #rpg-dialogue { top: auto; bottom: 80px; left: auto; right: 0; transform: translateY(20px); }
  #bot-container.fixed-mode #rpg-dialogue.active { transform: translateY(0); }
  #rpg-text { color: #bfdbfe; font-size: 0.9rem; min-height: 40px; line-height: 1.5; }
  #rpg-cursor { display: inline-block; width: 8px; height: 14px; background: #3b82f6; vertical-align: middle; animation: blink 1s infinite; }
  #rpg-options { display: flex; flex-direction: column; gap: 8px; margin-top: 5px; }
  .rpg-btn { background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); color: #93c5fd; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; text-align: left; transition: all 0.2s; opacity: 0; transform: translateX(-10px); animation: slideIn 0.3s forwards; }
  .rpg-btn:hover { background: rgba(59, 130, 246, 0.25); border-color: #60a5fa; color: #fff; transform: translateX(2px); }
  @keyframes slideIn { to { opacity: 1; transform: translateX(0); } }
  .rpg-close { position: absolute; top: 5px; right: 8px; font-size: 18px; color: #475569; cursor: pointer; }
  .rpg-close:hover { color: #fff; }
 
  /* --- ÂÜÖÂÆπÂÆπÂô® --- */
  .container { position: relative; padding: 60px 80px; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(20px) saturate(180%); -webkit-backdrop-filter: blur(20px) saturate(180%); border-radius: 20px; box-shadow: 0 20px 50px rgba(59, 130, 246, 0.15); border: 1px solid rgba(255, 255, 255, 0.1); border-top: 4px solid #3b82f6; opacity: 0; animation: fadeUp 0.8s ease-out 0.3s forwards; z-index: 1; transform-style: preserve-3d; transition: transform 0.1s ease-out; overflow: hidden; }
  .container::before { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(800px circle at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(255, 255, 255, 0.07), transparent 40%); z-index: -1; pointer-events: none; opacity: 0; transition: opacity 0.5s; }
  .container:hover::before { opacity: 1; }
  #main_content table { width: 100% !important; border-collapse: collapse; margin: 20px 0; background: rgba(10, 10, 15, 0.3); border-radius: 8px; overflow: hidden; }
  #main_content th, #main_content td { padding: 12px; border: 1px solid rgba(255, 255, 255, 0.1); }
  #main_content tr { background: rgba(30, 41, 59, 0.8) !important; }    
  #main_content th { color: #60a5fa; font-weight: 600; }
  .typewriter-container { font-family: 'JetBrains Mono', monospace; font-size: 1.1rem; color: #93c5fd; min-height: 1.6em; margin-bottom: 2rem; }
  .typewriter-cursor { animation: blink-cursor 0.8s infinite; border-left: 3px solid #3b82f6; margin-left: 2px; }
  .nav-badges { margin: 2rem 0; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
  .nav-badges a { opacity: 0; animation: fadeUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; position: relative; z-index: 2; }
  .nav-badges img { height: 28px !important; width: auto; border-radius: 50px; box-shadow: 0 2px 6px rgba(59, 130, 246, 0.15); border: 1.5px solid white; transition: all 0.3s; mix-blend-mode: normal !important; }
  .nav-badges a:hover img { animation: float-hover 2s ease-in-out infinite; box-shadow: 0 8px 20px rgba(59, 130, 246, 0.35); transform: scale(1.1); }
  .nav-badges img.rippling { animation: ripple-wave 0.5s forwards; }
        
  /* --- ÊåâÈíÆ & Ê®°Âºè --- */
  .controls-container { position: fixed; top: 20px; right: 20px; display: flex; gap: 15px; z-index: 10000; }
  .ctrl-btn { width: 40px; height: 40px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; backdrop-filter: blur(10px); transition: all 0.3s ease; font-size: 1.2rem; user-select: none; }
  .ctrl-btn:hover { background: rgba(255, 255, 255, 0.2); transform: scale(1.1); }
  #lang-toggle { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; font-weight: bold; width: auto; padding: 0 10px; border-radius: 20px; }
 
  /* --- ‚òÅÔ∏è Êä§ÁúºÊüîÂÖâÊ®°Âºè --- */
  body.light-mode { color: #334155; background-color: #ffffff; }
  body.light-mode #vanta-bg::after { background: radial-gradient(circle at center, rgba(241, 245, 249, 0.7) 0%, #f1f5f9 100%); }
  body.light-mode .container { background: rgba(241, 245, 249, 0.9); border-color: rgba(203, 213, 225, 0.6); box-shadow: 0 20px 50px rgba(148, 163, 184, 0.15); backdrop-filter: blur(25px); }
  body.light-mode #rpg-dialogue { background: #ffffff; border-color: #cbd5e1; box-shadow: 0 10px 30px rgba(148, 163, 184, 0.1); }
  body.light-mode #rpg-text { color: #334155; }
  body.light-mode .rpg-btn { background: rgba(226, 232, 240, 0.6); color: #475569; border-color: rgba(203, 213, 225, 0.8); }
  body.light-mode .rpg-btn:hover { background: #cbd5e1; color: #1e40af; border-color: #94a3b8; }
  body.light-mode #bot-speech { background: #ffffff; color: #334155; border-color: #cbd5e1; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
  body.light-mode .typewriter-container { color: #2563eb; }
  body.light-mode #main_content table { background: #f8fafc;   box-shadow: none; }
  body.light-mode #main_content th { color: #1e293b; background: #e2e8f0 !important; border-color: cbd5e1; }
  body.light-mode #main_content td { border-color: #e2e8f0; color: #334155; } 
  body.light-mode #main_content tr { background: transparent !important; }
  body.light-mode #main_content tr:hover { background: rgba(0, 0, 0, 0.03) !important;}
  body.light-mode .rpg-close { color: #94a3b8; }
  body.light-mode .rpg-close:hover { color: #ef4444; }
  body.light-mode .ctrl-btn { background: rgba(255, 255, 255, 0.5); border-color: #cbd5e1; color: #64748b; }
  body.light-mode .ctrl-btn:hover { background: #ffffff; color: #0f172a; transform: scale(1.05); }
  body.light-mode .img-caption { color: #2563eb; }
 
  @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes float-bot { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
  @keyframes blink { 0%, 48%, 52%, 100% { height: 0%; } 50% { height: 100%; } }
  @keyframes botEnter { from { opacity: 0; transform: translateX(-50%) translateY(20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
  @keyframes blink-cursor { from, to { opacity: 1; } 50% { opacity: 0; } }
  @keyframes pulse-antenna-breath { 0%, 100% { background: #3b82f6; box-shadow: 0 0 5px #3b82f6; } 50% { background: #93c5fd; box-shadow: 0 0 15px #60a5fa, 0 0 8px #ffffff; } }
  @keyframes mouth-talk { 0% { height: 2px; } 100% { height: 8px; border-radius: 50%; } }
   
  .welcome-modal {
    position: fixed; inset: 0; 
    background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
    z-index: 100001; 
    display: flex; justify-content: center; align-items: center;
    opacity: 0; pointer-events: none; transition: opacity 0.5s ease;
    padding: 20px;
    cursor: default !important;
  }
  .welcome-modal * { cursor: default !important; }
  .welcome-modal .btn-primary, .welcome-modal .btn-secondary, .welcome-modal .slider { cursor: pointer !important; }
  .welcome-modal.show { opacity: 1; pointer-events: auto; }
   
  .welcome-modal:hover ~ .cursor-dot, .welcome-modal:hover ~ .cursor-outline { opacity: 0 !important; }
   
  .modal-content {
    background: rgba(30, 41, 59, 0.85); 
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(20px);
    padding: 30px; border-radius: 20px; 
    width: 90%; max-width: 400px; text-align: center;
    margin: auto; 
    max-height: 90vh; overflow-y: auto; 
    transform: scale(0.9); transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative; 
    padding-bottom: 140px; 
  }
  .welcome-modal.show .modal-content { transform: scale(1); }
   
  .modal-title { font-size: 1.5rem; margin-bottom: 15px; color: #fff; font-weight: 600; }
  .modal-body { font-size: 1rem; color: #cbd5e1; margin-bottom: 25px; line-height: 1.6; }
  .m-zh { display: none; }
 
  .modal-btns { display: flex; flex-direction: column; gap: 10px; }
  .btn-primary, .btn-secondary {
    padding: 12px 20px; border-radius: 10px; font-weight: 600; transition: all 0.2s;
    border: none; font-family: inherit;
  }
  .btn-primary { background: #3b82f6; color: white; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4); }
  .btn-primary:hover { background: #2563eb; transform: translateY(-2px); }
  .btn-secondary { background: rgba(255, 255, 255, 0.1); color: #e2e8f0; }
  .btn-secondary:hover { background: rgba(255, 255, 255, 0.2); }
 
  .modal-lang-switch-container {
    position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%); 
    display: flex; flex-direction: column; align-items: center; gap: 4px; width: 100%; 
  }
  .lang-title { font-size: 0.7rem; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; }
  .lang-row { display: flex; align-items: center; gap: 8px; justify-content: center; font-size: 0.85rem; color: #cbd5e1; font-family: 'JetBrains Mono', monospace; }
  .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
  .switch input { opacity: 0; width: 0; height: 0; }
  .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #475569; transition: .4s; border-radius: 20px; }
  .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
  input:checked + .slider { background-color: #3b82f6; }
  input:focus + .slider { box-shadow: 0 0 1px #3b82f6; }
  input:checked + .slider:before { transform: translateX(20px); }
 
  .modal-watermark {
    position: absolute; bottom: 20px; left: 0; width: 100%; 
    text-align: center; font-size: 0.65rem; color: #94a3b8; font-family: 'JetBrains Mono', monospace; pointer-events: none; opacity: 0.6; 
  }

  /* --- üé¨ 3D Ê®°ÂûãÂºπÁ™óÊ†∑Âºè --- */
  .video-modal {
    position: fixed; inset: 0;
    background: rgba(0, 0, 0, 0.9); /* Ê∑±Ëâ≤ËÉåÊôØ */
    z-index: 100005; /* Âè™ÊúâÂÆÉËÉΩÁõñ‰ΩèÊú∫Âô®‰∫∫ */
    display: flex; justify-content: center; align-items: center;
    opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
    backdrop-filter: blur(10px);
  }
  .video-modal.show { opacity: 1; pointer-events: auto; }

  .video-content {
    width: 90%; max-width: 800px;
    background: rgba(15, 23, 42, 1);
    border: 1px solid #3b82f6;
    border-radius: 12px;
    box-shadow: 0 0 50px rgba(59, 130, 246, 0.3);
    overflow: hidden;
    transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  .video-modal.show .video-content { transform: scale(1); }

  .video-header {
    display: flex; justify-content: space-between; align-items: center;
    padding: 10px 20px;
    background: rgba(59, 130, 246, 0.1);
    border-bottom: 1px solid rgba(59, 130, 246, 0.3);
    color: #93c5fd; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;
  }
  .video-close {
    cursor: pointer; font-size: 1.5rem; line-height: 1; color: #64748b; transition: color 0.2s;
  }
  .video-close:hover { color: #ef4444; }

  /* Ê®°ÂûãËßÜÂõæÈ´òÂ∫¶ */
  model-viewer {
    width: 100%; height: 500px; background-color: #0f172a;
  }
 
  @media (max-width: 768px) { 
    #bot-speech {
      white-space: normal !important; max-width: 200px !important; width: max-content !important; height: auto !important; line-height: 1.5;
      left: auto !important; right: 0 !important; top: -55px !important; border-radius: 12px 12px 0 12px !important; 
      transform: translateX(0) scale(0) !important; transform-origin: bottom right !important; 
    }
    #bot-container.speaking #bot-speech { transform: translateX(0) scale(1) !important; }
    .cursor-dot, .cursor-outline { display: none; } 
    .layout-wrapper { margin-top: 40px !important; }
    .controls-container { top: 15px; right: 15px; gap: 8px; }
    .ctrl-btn { width: 35px; height: 35px; font-size: 1rem; }
    #lang-toggle { font-size: 0.7rem; padding: 0 8px; }
    #bot-container { 
      display: block !important; position: fixed !important; top: auto !important; left: auto !important;
      right: 20px !important; bottom: 30px !important; transform: scale(0.85) translateX(0) !important;
      opacity: 1 !important; animation: none !important;
    }
    #bot-container #rpg-dialogue {
      position: fixed !important; top: auto !important; bottom: 100px !important; left: 10px !important; right: 10px !important;
      width: auto !important; max-width: none !important; transform: translateY(10px) !important;
    }
    #bot-container #rpg-dialogue.active { transform: translateY(0) !important; }
    .container { padding: 30px 20px; } 
    #main_content { overflow-x: auto; }
    .modal-content { padding-bottom: 140px; } 

    /* ÊâãÊú∫Â±èÂπïÁ™ÑÔºåÊú∫Âô®‰∫∫‰∏çËÉΩÂú®Âè≥ËæπÔºåÂæóË∑ëÂà∞‰∏ãÈù¢Êåá‰∏äÈù¢ */
    #bot-container.guide-mode {
      top: auto !important;
      bottom: 20% !important; /* Âú®ËßÜÈ¢ë‰∏ãÊñπ */
      left: 50% !important;
      right: auto !important;
      transform: translateX(-50%) scale(1) !important;
    }
    
    /* ÁÆ≠Â§¥Êîπ‰∏∫Âêë‰∏äÊåá */
    .guide-arrow {
      left: 50%; top: -40px;
      transform: translateX(-50%) rotate(90deg); /* ÊóãËΩ¨90Â∫¶Âêë‰∏ä */
    }
    
    /* ÊâãÊú∫Á´ØÁÆ≠Â§¥Âä®ÁîªÔºöÂêë‰∏äË∑≥ */
    #bot-container.guide-mode .guide-arrow {
      animation: point-up 0.8s ease-in-out infinite alternate;
    }
    
    @keyframes point-up {
      from { transform: translateX(-50%) rotate(-90deg) translateY(0); }
      to { transform: translateX(-50%) rotate(-90deg) translateY(-15px); }
    }
  }
</style>
</head>
 
<body>
{% if page.glb_path %}
<div id="video-modal" class="video-modal">
  <div class="video-content">
    <div class="video-header">
      <span>üìΩÔ∏è 3D INTERACTIVE VIEW</span>
      <span class="video-close" onclick="closeVideoModal()">√ó</span>
    </div>
    
    <model-viewer
      src="{{ page.glb_path | relative_url }}"
      alt="3D Model"
      auto-rotate
      camera-controls
      shadow-intensity="1"
      style="width: 100%; height: 500px; background-color: #0f172a;"
    ></model-viewer>
    
  </div>
</div>
{% endif %}

<div id="welcome-modal" class="welcome-modal">
  <div class="modal-content">
    <div class="modal-title">
      <span class="m-en">‚ú® Hi, Welcome to E-Link!</span>
      <span class="m-zh">‚ú® Âó®ÔºÅÊ¨¢ËøéËÆøÈóÆE-LinkÔºÅ</span>
    </div>
    <div class="modal-body">
      <span class="m-en">
       We recommend <b>Dark Mode</b> for a more immersive experience<br>
       <span style="font-size: 0.85rem; color: #94a3b8;">
         (Feel free to tailor your view at the top-right corner)
       </span>
      </span>
      <span class="m-zh">
       ‰∏∫ÂëàÁé∞ÊúÄ‰Ω≥<b>ËßÜËßâ‰ΩìÈ™å</b>ÔºåÂª∫ËÆÆ‰øùÁïô<b>Ê∑±Ëâ≤ËÆæÁΩÆ</b> <br>
       <span style="font-size: 0.85rem; color: #94a3b8;">
         (ÊÇ®ÂèØÈöèÊó∂ÈÄöËøáÂè≥‰∏äËßíÂàáÊç¢ËØ≠Ë®ÄÊàñ‰∏ªÈ¢ò)
       </span>
      </span>
    </div>
    <div class="modal-btns">
      <button id="modal-keep-dark-btn" class="btn-primary">
        <span class="m-en">üåô Keep Dark Mode</span>
        <span class="m-zh">üåô ‰øùÊåÅÊ∑±Ëâ≤ (Êé®Ëçê)</span>
      </button>
      <button id="modal-switch-light-btn" class="btn-secondary">
        <span class="m-en">üîÜ Switch to Light Mode</span>
        <span class="m-zh">üîÜ ÂàáÊç¢Âà∞ÊµÖËâ≤</span>
      </button>
    </div>
    <div class="modal-lang-switch-container">
      <span class="lang-title">Language / ËØ≠Ë®Ä</span>
      <div class="lang-row">
        <span>English</span>
        <label class="switch">
          <input type="checkbox" id="modal-lang-toggle-checkbox">
          <span class="slider round"></span>
        </label>
        <span>ÁÆÄ‰Ωì‰∏≠Êñá</span>
      </div>
    </div>
    <div class="modal-watermark">
      <span class="m-en">Webpage Designed by Tianyu Bai ¬© 2026</span>
      <span class="m-zh">Êú¨ÁΩëÈ°µÁî± Tianyu Bai ËÆæËÆ°Âà∂‰Ωú ¬© 2026</span>
    </div>
  </div>
</div>
 
<div class="controls-container">
  <div id="lang-toggle" class="ctrl-btn" title="Switch Language">EN/CN</div>
  <div id="theme-toggle" class="ctrl-btn" title="Switch Theme">‚òÄÔ∏è</div>
</div>
 
<div class="cursor-dot"></div>
<div class="cursor-outline"></div>
<div id="progress-bar"></div>
<div id="vanta-bg"></div>
 
<canvas id="meteor-canvas"></canvas>
 
<div id="bot-container" title="Chat with me!">
  <div class="guide-arrow">‚û§</div>
  <div class="pulse-ring"></div>
  <div id="bot-speech">System Online.</div>
  <div id="rpg-dialogue">
    <div class="rpg-close">√ó</div>
    <div><span id="rpg-text">Initializing...</span><span id="rpg-cursor"></span></div>
    <div id="rpg-options"></div>
  </div>
  <div class="bot-antenna"></div>
  <div class="bot-head">
    <div class="bot-eye"><div class="bot-pupil"></div><div class="bot-lid"></div></div>
    <div class="bot-eye"><div class="bot-pupil"></div><div class="bot-lid"></div></div>
    <div class="bot-mouth"></div>
  </div>
</div>
 
<div class="layout-wrapper">
  <div class="container">
    <section id="main_content">
      {{ content }}
    </section>
 
    <div class="typewriter-container">
      <span id="typewriter-text"></span><span class="typewriter-cursor"></span>
    </div>
 
    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); text-align: center; color: #94a3b8; font-size: 0.85rem;">
      <p> E-Link ‚Ä¢ COPYRIGHT ¬© 2026 Tianyu Bai</p>
    </footer>
  </div>
</div>
 
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
<script>
  // --- üåç ÂèåËØ≠Êï∞ÊçÆÊ∫ê ---
  const dialogData_EN = {
    "start": {
      text: "Hi! I'm the Connector Guardian. I protect your neural interfaces.",
      options: [ 
         { text: "üßä View 3D Model", next: "play_video" }, // üî• Êîπ‰∏∫ 3D
         { text: "üöÄ Let's start!", next: "root_menu" } 
      ]
    },
    "play_video": {
       text: "Loading 3D schematic... You can rotate and zoom!",
       options: [ { text: "Close Viewer", next: "start" } ]
    },
    "root_menu": {
      text: "Select a category to inspect:",
      options: [
        { text: "üåü What's Special?", next: "innovation" },
        { text: "üìä Specifications (Weight/Noise)", next: "specs_menu" },
        { text: "üõ°Ô∏è Reliability & Durability", next: "reliability_menu" },
        { text: "üîß Usage & Compatibility", next: "usage_menu" },
        { text: "Just browsing", next: "close" }
      ]
    },
    "innovation": {
      text: "I feature a novel elastomeric interposer. This means NO precise alignment is needed and ZERO insertion force.",
      options: [
        { text: "Why is 'Zero Force' better?", next: "zero_force" },
        { text: "Can it scale up?", next: "scalability" },
        { text: "Back to Menu", next: "root_menu" } 
      ]
    },
    "zero_force": {
      text: "Traditional plugs require high force, risking probe fracture. My threaded cap converts rotation into gentle vertical pressure, protecting delicate films.",
      options: [ { text: "Cool! Back.", next: "innovation" } ]
    },
    "scalability": {
      text: "Yes! The fine-pitch elastomer allows scaling to 1024 channels within the same 25mm footprint. I am future-proof.",
      options: [ { text: "Got it, Back.", next: "innovation" } ]
    },
    "specs_menu": {
      text: "Checking Diagnostics... Which parameter concerns you?",
      options: [
        { text: "Is it heavy? (Weight)", next: "weight" },
        { text: "Does it get hot? (Thermal)", next: "thermal" },
        { text: "How clean is the signal? (Noise)", next: "noise" },
        { text: "Back to Menu", next: "root_menu" }
      ]
    },
    "weight": {
      text: "I am ultra-light. Detached weight is only 2.8g. Even housed, I am 57% lighter (6.6g) than competitors, reducing strain on the animal.",
      options: [ { text: "Good for mice/rats.", next: "specs_menu" } ]
    },
    "thermal": {
      text: "I stay cool. Steady-state temperature is 30.5¬∞C, well below the 37¬∞C biological threshold. No active cooling required.",
      options: [ { text: "Safe confirmed.", next: "specs_menu" } ]
    },
    "noise": {
      text: "Crystal clear. My noise floor is 2.68 ¬± 0.46 ¬µV RMS, matching the theoretical limit of the Intan chips. No signal degradation.",
      options: [ { text: "Great specs.", next: "specs_menu" } ]
    },
    "reliability_menu": {
      text: "I am built to last. What is your concern?",
      options: [
        { text: "Lifespan (Cycles)", next: "cycles" },
        { text: "What if I align it wrong?", next: "misalignment" },
        { text: "Contact Impedance?", next: "impedance" },
        { text: "Back to Menu", next: "root_menu" }
      ]
    },
    "cycles": {
      text: "Verified for 100+ mating cycles with >97% connection yield. The elastomer shows negligible wear.",
      options: [ { text: "Solid.", next: "reliability_menu" } ]
    },
    "misalignment": {
      text: "No problem. The elastomer has 'structural redundancy' (pitch < pad size). Even with radial misalignment, the connection holds.",
      options: [ { text: "Very forgiving.", next: "reliability_menu" } ]
    },
    "impedance": {
      text: "Low and stable. Contact impedance is consistently between 0.3 kŒ© and 0.4 kŒ© across the array.",
      options: [ { text: "Acknowledged.", next: "reliability_menu" } ]
    },
    "usage_menu": {
      text: "Designed for researchers. Ask me about usage:",
      options: [
        { text: "Is assembly difficult?", next: "assembly" },
        { text: "Compatible Systems?", next: "system" },
        { text: "For freely moving animals?", next: "animal" },
        { text: "Back to Menu", next: "root_menu" }
      ]
    },
    "assembly": {
      text: "Easy. No specialized micro-soldering needed. It's a 'plug-and-play' assembly using standard tools.",
      options: [ { text: "User friendly.", next: "usage_menu" } ]
    },
    "system": {
      text: "Fully compatible with the Intan RHD recording system. Supports 64, 128, and 256 channel configurations.",
      options: [ { text: "Perfect.", next: "usage_menu" } ]
    },
    "animal": {
      text: "Yes. The low profile fits mechanical commutators, allowing natural behavior without cable twisting.",
      options: [ { text: "Show me the files!", next: "show_badges" } ]
    },
    "show_badges": {
      text: "Scroll to the bottom! üëá Those icons are your gateway to the Code, Fabrication Files, and Demo Videos.",
      options: [ { text: "Thanks, Guardian!", next: "close" } ]
    }
  };

  const dialogData_ZH = {
    "start": {
      text: "‰Ω†Â•ΩÔºÅÊàëÊòØÊòìÈìæÁöÑÂÆàÊä§ËÄÖ„ÄÇÁî±ÊàëÊù•‰øùÊä§‰Ω†ÁöÑËÑëÊú∫Êé¢Èíà„ÄÇ",
      options: [ 
        { text: "üßä Êü•Áúã 3D Ê®°Âûã", next: "play_video" }, // üî• Êîπ‰∏∫ 3D
        { text: "üöÄ ÂºÄÂßãÊé¢Á¥¢ÔºÅ", next: "root_menu" } 
      ]
    },
    "play_video": {
       text: "Ê≠£Âú®Âä†ËΩΩ 3D ÁªìÊûÑ... ‰Ω†ÂèØ‰ª•ÊãñÊãΩÊóãËΩ¨ÔºÅ",
       options: [ { text: "ÂÖ≥Èó≠ËßÜÂõæ", next: "start" } ]
    },
    "root_menu": {
      text: "Á≥ªÁªüÂ∑≤Â∞±Áª™„ÄÇËØ∑ÈÄâÊã©ÊÉ≥Ë¶ÅÊü•ÁúãÁöÑÁ±ªÂà´Ôºö",
      options: [
        { text: "üåü Ê†∏ÂøÉ‰∫ÆÁÇπ", next: "innovation" },
        { text: "üìä ËßÑÊ†ºÂèÇÊï∞ (ÈáçÈáè/Âô™Èü≥)", next: "ÂèÇÊï∞ËèúÂçï" },
        { text: "üõ°Ô∏è ÂèØÈù†ÊÄß‰∏éËÄê‰πÖÂ∫¶", next: "ÂèØÈù†ÊÄßËèúÂçï" },
        { text: "üîß ‰ΩøÁî®‰∏éÂÖºÂÆπÊÄß", next: "usage_menu" },
        { text: "Èöè‰æøÁúãÁúã", next: "close" }
      ]
    },
    "innovation": {
      text: "ÊàëÈááÁî®‰∫ÜÊñ∞ÂûãÂºπÊÄß‰Ωì‰∫íËøûÊäÄÊúØ (Elastomeric Interposer)„ÄÇËøôÊÑèÂë≥ÁùÄÊó†ÈúÄÁ≤æÁ°ÆÂØπÂáÜÔºå‰∏îÂÆûÁé∞‰∫Ü‚ÄúÈõ∂ÊèíÂÖ•Âäõ‚Äù„ÄÇ",
      options: [
        { text: "‚ÄúÈõ∂ÊèíÂÖ•Âäõ‚ÄùÊúâ‰ªÄ‰πàÂ•ΩÂ§ÑÔºü", next: "Èõ∂ÊèíÂÖ•Âäõ" },
        { text: "ÈÄöÈÅìÊï∞ËÉΩÊâ©Â±ïÂêóÔºü", next: "ÂèØÊãìÂ±ïÊÄß" },
        { text: "ËøîÂõû‰∏ªËèúÂçï", next: "root_menu" } 
      ]
    },
    "Èõ∂ÊèíÂÖ•Âäõ": {
      text: "‰º†ÁªüÊèíÂ§¥ÈúÄË¶ÅÂæàÂ§ßÁöÑÂäõÔºåÂÆπÊòìÂºÑÊñ≠ËÑÜÂº±ÁöÑÊé¢Èíà„ÄÇÊàëÁöÑËû∫Á∫πÁõñÂ∞ÜÊóãËΩ¨ËΩ¨Âåñ‰∏∫ËΩªÊüîÁöÑÂûÇÁõ¥ÂéãÂäõÔºåÂÆåÁæé‰øùÊä§ËñÑËÜúÊé¢Èíà„ÄÇ",
      options: [ { text: "ÂæàÊ£íÁöÑËÆæËÆ°ÔºÅËøîÂõû„ÄÇ", next: "innovation" } ]
    },
    "ÂèØÊãìÂ±ïÊÄß": {
      text: "ÂΩìÁÑ∂ÔºÅÈ´òÂØÜÂ∫¶ÂºπÊÄß‰ΩìÂÖÅËÆ∏Âú®ÂêåÊ†∑ÁöÑ 25mm Â∞ÅË£ÖÂÜÖÊâ©Â±ïËá≥ 1024 ÈÄöÈÅì„ÄÇÊàëÊòØÈù¢ÂêëÊú™Êù•ÁöÑËÆæËÆ°„ÄÇ",
      options: [ { text: "Â∑≤Áü•ÊôìÔºåËøîÂõû„ÄÇ", next: "innovation" } ]
    },
    "ÂèÇÊï∞ËèúÂçï": {
      text: "Ê≠£Âú®Ê£ÄÊü•ËØäÊñ≠Êï∞ÊçÆ... ‰Ω†ÂÖ≥ÂøÉÂì™‰∏™ÂèÇÊï∞Ôºü",
      options: [
        { text: "Èáç‰∏çÈáçÔºü (ÈáçÈáè)", next: "weight" },
        { text: "ÂèëÁÉ≠ÂêóÔºü (ÁÉ≠Â≠¶)", next: "thermal" },
        { text: "‰ø°Âè∑Âπ≤ÂáÄÂêóÔºü (Âô™Èü≥)", next: "noise" },
        { text: "ËøîÂõû‰∏ªËèúÂçï", next: "root_menu" }
      ]
    },
    "weight": {
      text: "ÊàëÈùûÂ∏∏ËΩª„ÄÇÊãÜÂç∏Âêé‰ªÖÈáç 2.8g„ÄÇÂç≥‰ΩøÂê´Â§ñÂ£≥ÔºåÊàë‰πüÊØîÁ´ûÂìÅËΩª 57% (6.6g)ÔºåÂ§ßÂ§ßÂáèËΩª‰∫ÜÂä®Áâ©ÁöÑË¥üÊãÖ„ÄÇ",
      options: [ { text: "ÂæàÈÄÇÂêàÂ∞èÈº†/Â§ßÈº†„ÄÇ", next: "specs_menu" } ]
    },
    "thermal": {
      text: "ÊàëËøêËΩ¨ÂÜ∑Èùô„ÄÇÁ®≥ÊÄÅÊ∏©Â∫¶‰ªÖ‰∏∫ 30.5¬∞CÔºåËøú‰Ωé‰∫é 37¬∞C ÁöÑÁîüÁâ©ÈòàÂÄº„ÄÇÊó†ÈúÄ‰∏ªÂä®Êï£ÁÉ≠„ÄÇ",
      options: [ { text: "ÂÆâÂÖ®Á°ÆËÆ§„ÄÇ", next: "specs_menu" } ]
    },
    "noise": {
      text: "Âô™Â£∞ÂæàÂ∞è„ÄÇÊàëÁöÑÊú¨Â∫ïÂô™Â£∞‰∏∫ 2.68 ¬± 0.46 ¬µV RMSÔºåÊé•Ëøë‰∫Ü Intan ËäØÁâáÁöÑÁêÜËÆ∫ÊûÅÈôê„ÄÇ‰ø°Âè∑Êó†ÊçüËÄó„ÄÇ",
      options: [ { text: "ÂèÇÊï∞ÂæàÂº∫„ÄÇ", next: "specs_menu" } ]
    },
    "ÂèØÈù†ÊÄßËèúÂçï": {
      text: "ÊàëÁªè‰πÖËÄêÁî®„ÄÇÁåú‰Ω†ÊúâÂèØËÉΩÊãÖÂøÉËøô‰∫õÔºü",
      options: [
        { text: "ÂØøÂëΩ (Ë¥¥ÂêàÊ¨°Êï∞)", next: "cycles" },
        { text: "Â¶ÇÊûúÂØπ‰∏çÂáÜÊÄé‰πàÂäûÔºü", next: "misalignment" },
        { text: "Êé•Ëß¶ÁîµÈòªÂ§öÂ§ßÔºü", next: "impedance" },
        { text: "ËøîÂõû‰∏ªËèúÂçï", next: "root_menu" }
      ]
    },
    "cycles": {
      text: "Â∑≤È™åËØÅ 100 Ê¨°‰ª•‰∏äÁöÑÊèíÊãîÂæ™ÁéØÔºåËøûÊé•ËâØÁéá >97%„ÄÇÂºπÊÄßÂØºÁîµ‰ΩìÂá†‰πéÊ≤°ÊúâÁ£®Êçü„ÄÇ",
      options: [ { text: "ÂæàÈù†Ë∞±ÔºåÂ∑≤Áü•Êôì", next: "ÂèØÈù†ÊÄßËèúÂçï" } ]
    },
    "misalignment": {
      text: "ÂºπÊÄß‰ΩìÂÖ∑Êúâ‚ÄúÁªìÊûÑÂÜó‰Ωô‚ÄùÔºàÈó¥Ë∑ùÂ∞è‰∫éÁÑäÁõòÂ∞∫ÂØ∏Ôºâ„ÄÇÂç≥‰ΩøÂæÑÂêëÊ≤°ÂØπÂáÜÔºå‰æùÁÑ∂ËÉΩÁ®≥ÂÆöËøûÊé•„ÄÇ",
      options: [ { text: "ÂÆπÈîôÁéáÂæàÈ´òÔºåÂ∑≤Áü•Êôì", next: "ÂèØÈù†ÊÄßËèúÂçï" } ]
    },
    "impedance": {
      text: "‰Ωé‰∏îÁ®≥ÂÆö„ÄÇÊï¥‰∏™ÈòµÂàóÁöÑÊé•Ëß¶ÈòªÊäóÂßãÁªà‰øùÊåÅÂú® 0.3 kŒ© Âà∞ 0.4 kŒ© ‰πãÈó¥„ÄÇ",
      options: [ { text: "Â∑≤Áü•Êôì", next: "ÂèØÈù†ÊÄßËèúÂçï" } ]
    },
    "usage_menu": {
      text: "‰∏ì‰∏∫Áõ∏ÂÖ≥È¢ÜÂüü‰∫∫ÂëòËÆæËÆ°„ÄÇÈóÆÊàëÂÖ≥‰∫é‰ΩøÁî®ÁöÑÈóÆÈ¢òÔºö",
      options: [
        { text: "ÁªÑË£ÖÂÆπÊòìÂêóÔºü", next: "assembly" },
        { text: "ÂÖºÂÆπÂì™‰∫õÈááÈõÜÁ≥ªÁªüÔºü", next: "system" },
        { text: "Âä®Áâ©ËÉΩËá™Áî±Ê¥ªÂä®ÂêóÔºü", next: "animal" },
        { text: "ËøîÂõû‰∏ªËèúÂçï", next: "root_menu" }
      ]
    },
    "assembly": {
      text: "ÈùûÂ∏∏ÂÆπÊòì.Âç≥ÊãßÂç≥Áî®ÁöÑÊ®°ÂùóÂåñËÆæËÆ°ÔºåÂëäÂà´ÊèíÊãîÂ∏¶Êù•ÁöÑÊñ≠ÈíàÂºØÈíàÔºåËΩªÊùæÂª∫Á´ãËøûÊé•",
      options: [ { text: "Â∑≤Áü•Êôì", next: "usage_menu" } ]
    },
    "system": {
      text: "ÂÆåÂÖ®ÂÖºÂÆπIntan RHDËÆ∞ÂΩïÁ≥ªÁªü. ÊîØÊåÅ64Ôºå128Ôºå256ÈÄöÈÅìËÆæÂÆö.",
      options: [ { text: "ÂÆåÁæéÔºåÂ∑≤Áü•Êôì", next: "usage_menu" } ]
    },
    "animal": {
      text: "ÂèØ‰ª•„ÄÇ‰ΩéÂâñÈù¢ËÆæËÆ°ÈÄÇÈÖçÊú∫Ê¢∞Êç¢ÂêëÂô® (Commutator)ÔºåÂÖÅËÆ∏Âä®Áâ©Ëá™ÁÑ∂Ë°å‰∏∫ÔºåÁ∫øÁºÜ‰∏çÊâìÁªì„ÄÇ",
      options: [ { text: "ÊàëÊÉ≥Êü•ÁúãÊñá‰ª∂", next: "ÂæΩÁ´†ÊåáÂºï" } ]
    },
    "ÂæΩÁ´†ÊåáÂºï": {
      text: "ÊªëÂà∞ÊúÄ‰∏ãÈù¢ÔºÅüëáÁ∫¢Ëâ≤ÂõæÊ†áÊòØ‰Ω†ÈÄöÂæÄ‰ª£Á†Å„ÄÅÂà∂ÈÄ†Êñá‰ª∂ÂíåÊºîÁ§∫ËßÜÈ¢ëÁöÑÂ§ßÈó®„ÄÇ",
      options: [ { text: "Ë∞¢Ë∞¢ÊòìÈìæÂÆàÊä§ËÄÖÔºÅ", next: "ÂÖ≥Èó≠ÂØπËØùÁ™ó" } ]
    }
  };
     
  // ÈªòËÆ§‰ΩøÁî®Ëã±Êñá
  let currentLang = 'en';
  let dialogData = dialogData_EN;

  let vantaEffect;
  
  // üî• Á¨¨‰∏ÄÈò∂ÊÆµÔºöDOM Âä†ËΩΩÂÆåÊàêÔºåÁ´ãÂàªÂ§ÑÁêÜÈ¶ñÂ±è
  document.addEventListener("DOMContentLoaded", function() {
      // 1. Á´ãÂç≥ÂêØÂä® Vanta ËÉåÊôØ
      if (window.VANTA) {
        vantaEffect = VANTA.NET({
          el: "#vanta-bg",
          mouseControls: true, touchControls: true, gyroControls: false,
          minHeight: 200.00, minWidth: 200.00, scale: 1.00, scaleMobile: 1.00,
          color: 0x3b82f6, backgroundColor: 0x0a0a0f, points: 18.00, maxDistance: 28.00, spacing: 16.00, showDots: true
        });
      }

      // 2. ÂêØÂä®ÊµÅÊòüÁâπÊïà
      initMeteors();

      // 3. Êô∫ËÉΩÂä†ËΩΩÁ≠ñÁï• - Èò∂ÊÆµ‰∏Ä
      // ÂÖàÊääÊâÄÊúâÂõæÁâáËÆæ‰∏∫ lazyÔºåÈò≤Ê≠¢ÈòªÂ°ûÈ¶ñÂ±èÔºåÈô§ÈùûÂÆÉÊòØÂâç‰∏§Âº†
      const images = document.querySelectorAll('#main_content img');
      images.forEach((img, index) => {
          if (index < 2) {
              // È¶ñÂ±èÂõæÁâáÔºöÁ´ãÂç≥Âä†ËΩΩ
              img.setAttribute('loading', 'eager'); 
              img.setAttribute('fetchpriority', 'high'); 
          } else {
              // ÂÖ∂‰ªñÂõæÁâáÔºöÂÖàÊöÇÁºì
              if(!img.getAttribute('loading')) {
                 img.setAttribute('loading', 'lazy');
              }
          }
      });
  });

  // üî• Á¨¨‰∫åÈò∂ÊÆµÔºöÊâÄÊúâËµÑÊ∫êÂä†ËΩΩÂÆåÊØïÔºàPage LoadÔºâÔºåÂºÄÂßãÈùôÈªò‰∏ãËΩΩÂä®Âõæ
  window.addEventListener('load', function() {
      // ÊâæÂà∞ÊâÄÊúâGIFÂõæÁâáÂíåËßÜÈ¢ëÂíå3DÊ®°Âûã
 const heavyMedia = document.querySelectorAll('img[src$=".gif"], video, model-viewer');

      heavyMedia.forEach(media => {
    // ... ÂéüÊúâÈÄªËæë ...
    
    // Â¶ÇÊûúÊòØ 3D Ê®°ÂûãÔºåËÆæÁΩÆ eager Âä†ËΩΩ
    if (media.tagName === 'MODEL-VIEWER') {
        media.setAttribute('loading', 'eager');
    }
});
   
      heavyMedia.forEach(media => {
          // Âº∫Âà∂Êîπ‰∏∫ EagerÔºåÂà©Áî®Á©∫Èó≤Â∏¶ÂÆΩ‰∏ãËΩΩ
          // ËøôÊ†∑Áî®Êà∑Êªë‰∏ãÂéªÊó∂ÔºåÂä®ÂõæÂ∑≤ÁªèÂáÜÂ§áÂ•Ω‰∫Ü
          media.setAttribute('loading', 'eager');
          
          // Â¶ÇÊûúÊòØËßÜÈ¢ëÔºåËÆæÁΩÆÈ¢ÑÂä†ËΩΩ
          if(media.tagName === 'VIDEO') {
              media.setAttribute('preload', 'auto');
          }
      });
  });

  const textsEN = ["Welcome to this webpageÔºÅ", "Thanks for visiting us!", "Stay tuned!"];
  const textsZH = ["Ê¨¢ËøéËÆøÈóÆÊú¨ÁΩëÈ°µÔºÅ", "ÊÑüË∞¢ÊÇ®ÁöÑÂÖ≥Ê≥®ÔºÅ", "Ê¨¢ËøéÂ∏∏Êù•ËÆøÈóÆÔºÅ"];
  let texts = textsEN; // ÈªòËÆ§ÊñáÊú¨
 
  let textIdx = 0, charIdx = 0, isDeleting = false;
  function type() {
    const currentText = texts[textIdx];
    const display = isDeleting ? currentText.substring(0, charIdx--) : currentText.substring(0, charIdx++);
    document.getElementById('typewriter-text').textContent = display;
    let speed = isDeleting ? 50 : 100;
    if (!isDeleting && charIdx === currentText.length + 1) { isDeleting = true; speed = 2000; } 
    else if (isDeleting && charIdx === 0) { isDeleting = false; textIdx = (textIdx + 1) % texts.length; speed = 500; }
    setTimeout(type, speed);
  }

  // --- üî• Á•ûÁªèÂÖÉÊµÅÊòüÁâπÊïàÈÄªËæë --- 
  function initMeteors() {
    const canvas = document.getElementById('meteor-canvas');
    if(!canvas) return;
    const ctx = canvas.getContext('2d');
    let width, height;
    function resizeCanvas() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    class Meteor {
      constructor() { this.reset(); }
      reset() {
        this.x = Math.random() * width;
        this.y = Math.random() * height;
        this.len = Math.random() * 100 + 50;
        this.speed = Math.random() * 1 + 1;
        this.size = Math.random() * 1 + 0.5;
        this.angle = (Math.PI * 0.75) + (Math.random() - 0.5) * 0.5;
        this.opacity = 0;
        this.state = 'fadein'; // fadein, active, fadeout
        this.life = 0;
        this.maxLife = Math.random() * 30 + 20; // Â≠òÊ¥ªÂ∏ßÊï∞
      }
      update() {
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed;
        if(this.state === 'fadein') {
           this.opacity += 0.1;
           if(this.opacity >= 1) this.state = 'active';
        } else if(this.state === 'active') {
           this.life++;
           if(this.life > this.maxLife) this.state = 'fadeout';
        } else if(this.state === 'fadeout') {
           this.opacity -= 0.05;
           if(this.opacity <= 0) this.reset();
        }
        if(this.x < -100 || this.x > width + 100 || this.y < -100 || this.y > height + 100) {
           this.reset();
        }
      }
      draw() {
        if(this.opacity <= 0) return;
        const tailX = this.x - Math.cos(this.angle) * this.len;
        const tailY = this.y - Math.sin(this.angle) * this.len;
        const gradient = ctx.createLinearGradient(this.x, this.y, tailX, tailY);
        gradient.addColorStop(0, `rgba(96, 165, 250, ${this.opacity})`); 
        gradient.addColorStop(1, `rgba(59, 130, 246, 0)`);  
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(tailX, tailY);
        ctx.strokeStyle = gradient;
        ctx.lineWidth = this.size;
        ctx.lineCap = 'round';
        ctx.stroke();
      }
    }
    
    const meteors = [];
    const meteorCount = 6; 
    for(let i=0; i<meteorCount; i++) {
       const m = new Meteor();
       m.opacity = 0; 
       m.life = Math.random() * 50;
       meteors.push(m);
    }
    
    function animateMeteors() {
      ctx.clearRect(0, 0, width, height);
      meteors.forEach(m => { m.update(); m.draw(); });
      requestAnimationFrame(animateMeteors);
    }
    animateMeteors();
  }
 
  document.addEventListener("DOMContentLoaded", function() {
    type();
    const cursorDot = document.querySelector('.cursor-dot');
    const cursorOutline = document.querySelector('.cursor-outline');
    const container = document.querySelector('.container');
    const pupils = document.querySelectorAll('.bot-pupil');
    const botContainer = document.getElementById('bot-container');
    const botSpeech = document.getElementById('bot-speech');
       
    const rpgDialogue = document.getElementById('rpg-dialogue');
    const rpgText = document.getElementById('rpg-text');
    const rpgOptions = document.getElementById('rpg-options');
    const rpgClose = document.querySelector('.rpg-close');
    let typeTimer = null;
 
    // --- üî• ÂºπÁ™óÈÄªËæë ---
    const welcomeModal = document.getElementById('welcome-modal');
    const modalKeepDarkBtn = document.getElementById('modal-keep-dark-btn');
    const modalSwitchLightBtn = document.getElementById('modal-switch-light-btn');
    const modalLangCheckbox = document.getElementById('modal-lang-toggle-checkbox');
    let modalIsZh = false; 
 
    setTimeout(() => {
      welcomeModal.classList.add('show');
    }, 100);
 
    // --- ü§ñ ÊèêÁ§∫ËØ≠ËΩÆÊí≠ ---
    let idleInterval;
    let tipIndex = 0;
 
    function startIdleTips() {
      if(idleInterval) clearInterval(idleInterval);
      const enTips = ["Click me for guide!", "I'm here to help!"];
      const zhTips = ["ÊàëÊòØE-Link‰∏ìÂ±ûÁÆ°ÂÆ∂", "Ê¨¢ËøéÈöèÊó∂‚ÄúÊï≤‚ÄùÊàëÂìàÔºÅ"];
      const runCycle = () => {
         const tips = currentLang === 'en' ? enTips : zhTips;
         botSay(tips[tipIndex], 3000); 
         tipIndex = (tipIndex + 1) % 2;
      };
      runCycle(); 
      idleInterval = setInterval(runCycle, 3500);
    }
 
    function closeModal() {
      welcomeModal.classList.remove('show');
      if (modalIsZh) {
        if (currentLang !== 'zh') langToggle.click(); 
      } else {
        if (currentLang === 'zh') langToggle.click();
      }
      setTimeout(() => {
          botContainer.classList.add('attention-jump'); 
          startIdleTips();
          setTimeout(() => {
              botContainer.classList.remove('attention-jump');
          }, 3200);
      }, 100);
    }
 
    modalKeepDarkBtn.addEventListener('click', closeModal);
    modalSwitchLightBtn.addEventListener('click', () => {
      themeToggle.click(); 
      closeModal();        
    });
 
    modalLangCheckbox.addEventListener('change', () => {
      const enTexts = document.querySelectorAll('.m-en');
      const zhTexts = document.querySelectorAll('.m-zh');
      modalIsZh = modalLangCheckbox.checked;
      if (modalIsZh) {
        enTexts.forEach(el => el.style.display = 'none');
        zhTexts.forEach(el => el.style.display = 'inline'); 
      } else {
        zhTexts.forEach(el => el.style.display = 'none');
        enTexts.forEach(el => el.style.display = 'inline');
      }
    });
 
    // --- ÂàáÊç¢ÈÄªËæë ---
    const themeToggle = document.getElementById('theme-toggle');
    const langToggle = document.getElementById('lang-toggle');
    let isLight = false;
       
    themeToggle.addEventListener('click', () => {
      isLight = !isLight;
      document.body.classList.toggle('light-mode');
      if (isLight) {
        themeToggle.textContent = "üåô"; 
        if (vantaEffect) vantaEffect.setOptions({ color: 0x2563eb, backgroundColor: 0xf1f5f9, points: 12.00, maxDistance: 24.00 });
      } else {
        themeToggle.textContent = "‚òÄÔ∏è"; 
        if (vantaEffect) vantaEffect.setOptions({ color: 0x3b82f6, backgroundColor: 0x0a0a0f, points: 18.00, maxDistance: 28.00 });
      }
    });
 
    langToggle.addEventListener('click', () => {
      const enContent = document.querySelectorAll('.lang-en');
      const zhContent = document.querySelectorAll('.lang-zh');
      if (currentLang === 'en') {
           currentLang = 'zh';
           dialogData = dialogData_ZH; 
           texts = textsZH;            
           langToggle.textContent = "‰∏≠ / Ëã±";
           enContent.forEach(el => el.style.display = 'none');
           zhContent.forEach(el => el.style.display = 'block');
      } else {
           currentLang = 'en';
           dialogData = dialogData_EN;
           texts = textsEN;
           langToggle.textContent = "EN / CN";
           enContent.forEach(el => el.style.display = 'block');
           zhContent.forEach(el => el.style.display = 'none');
      }
      textIdx = 0; charIdx = 0; isDeleting = false;
      if(rpgDialogue.classList.contains('active')) closeDialogue();
      if (!rpgDialogue.classList.contains('active') && idleInterval) {
           startIdleTips();
      }
    });
 
    let mouseX = window.innerWidth / 2;
    let mouseY = 100;
 
    window.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
      if(cursorDot) { cursorDot.style.left = `${mouseX}px`; cursorDot.style.top = `${mouseY}px`; }
      if(cursorOutline) { cursorOutline.animate({ left: `${mouseX}px`, top: `${mouseY}px` }, { duration: 500, fill: "forwards" }); }
      if (window.innerWidth > 768 && container) {
        const rx = (window.innerWidth / 2 - mouseX) / 50;
        const ry = (window.innerHeight / 2 - mouseY) / 50;
        container.style.transform = `rotateY(${rx * -1}deg) rotateX(${ry}deg)`;
        const rect = container.getBoundingClientRect();
        container.style.setProperty("--mouse-x", `${mouseX - rect.left}px`);
        container.style.setProperty("--mouse-y", `${mouseY - rect.top}px`);
      }
      pupils.forEach(p => {
        const rect = p.parentElement.getBoundingClientRect();
        const cx = rect.left + rect.width / 2, cy = rect.top + rect.height / 2;
        const angle = Math.atan2(mouseY - cy, mouseX - cx);
        const dist = Math.min(6, Math.hypot(mouseX - cx, mouseY - cy) / 10);
        p.style.transform = `translate(calc(-50% + ${Math.cos(angle) * dist}px), calc(-50% + ${Math.sin(angle) * dist}px))`;
      });
    });
 
    window.addEventListener('scroll', () => {
      const scrolled = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
      const pb = document.getElementById("progress-bar");
      if(pb) pb.style.width = scrolled + "%";
      if(botContainer && window.innerWidth > 768) {
        if(window.scrollY > 200) { botContainer.classList.add('fixed-mode'); } 
        else { botContainer.classList.remove('fixed-mode'); }
      }
    });
 
    function botSay(text, duration = 2000) {
      if(!botSpeech || !botContainer || rpgDialogue.classList.contains('active')) return; 
      botSpeech.textContent = text;
      botContainer.classList.add('speaking');
      if(botContainer.speechTimer) clearTimeout(botContainer.speechTimer);
      botContainer.speechTimer = setTimeout(() => {
        botContainer.classList.remove('speaking');
      }, duration);
    }

    // --- üé¨ 3D Ê®°ÂûãÊéßÂà∂ÈÄªËæë ---
    const videoModal = document.getElementById('video-modal');
    // Ê≥®ÊÑèÔºömodel-viewer ÂÖÉÁ¥†‰∏çÈúÄË¶ÅÂÉè video ÈÇ£Ê†∑Ë∞ÉÁî® play()
    
    window.openVideoModal = function() {
      videoModal.classList.add('show');
      // üî• Êú∫Âô®‰∫∫ËøõÂÖ•ÂºïÂØºÊ®°Âºè
      botContainer.classList.add('guide-mode');
      const clickText = currentLang === 'en' ? "Drag to Rotate! üëâ" : "ÊãñÊãΩÊ®°ÂûãÊü•ÁúãÁªÜËäÇÔºÅüëâ";
      botSay(clickText, 4000); 
      closeDialogue(); 
    }

    window.closeVideoModal = function() {
      videoModal.classList.remove('show');
      // üî• Êú∫Âô®‰∫∫ÂΩí‰Ωç
      botContainer.classList.remove('guide-mode');
      const backText = currentLang === 'en' ? "Did you see that mechanism?" : "ÁúãÂà∞ÈÇ£‰∏™Êú∫Ê¢∞ÁªìÊûÑ‰∫ÜÂêóÔºü";
      setTimeout(() => botSay(backText, 3000), 500);
    }
    
    videoModal.addEventListener('click', (e) => {
      // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠Ôºå‰ΩÜÁÇπÂáªÊ®°ÂûãÊú¨Ë∫´‰∏çÂÖ≥Èó≠
      if(e.target === videoModal) closeVideoModal();
    });

    function showDialogueNode(nodeKey, isFastMode = false) {
      // üî• Êã¶Êà™Êí≠ÊîæÊåá‰ª§
      if (nodeKey === 'play_video') {
         const loadingText = currentLang === 'en' ? "Loading 3D Module..." : "Ê≠£Âú®Âä†ËΩΩ 3D Ê®°Âùó...";
         botSay(loadingText, 2000);
         setTimeout(() => {
             openVideoModal();
         }, 1000);
         return; 
      }

      if(nodeKey === 'close') { 
           closeDialogue(); 
           botContainer.classList.add('interaction-done');
           const byeText = currentLang === 'en' ? "Nice chatting with you!" : "ÂæàÈ´òÂÖ¥‰∏é‰Ω†‰∫§Ë∞àÔºÅ";
           botSay(byeText, 3000); 
           return; 
      }   
      
      const node = dialogData[nodeKey];
      if(!node) return;
      rpgOptions.innerHTML = ''; 
      if(typeTimer) clearInterval(typeTimer);
 
      const showButtons = () => {
           node.options.forEach((opt, idx) => {
             const btn = document.createElement('div');
             btn.className = 'rpg-btn'; 
             btn.textContent = '> ' + opt.text;
             
             const isBackAction = opt.text.includes("Back") || opt.text.includes("ËøîÂõû");
 
             if(isFastMode) {
                 btn.style.opacity = 1;
                 btn.style.transform = 'translateX(0)';
                 btn.style.animation = 'none'; 
             } else {
                 btn.style.animationDelay = `${idx * 0.1}s`;
             }
 
             btn.onclick = (e) => { 
                 e.stopPropagation(); 
                 showDialogueNode(opt.next, isBackAction); 
             };
             rpgOptions.appendChild(btn);
           });
      };
 
      if (isFastMode) {
           rpgText.textContent = node.text; 
           showButtons();
      } else {
           rpgText.textContent = '';
           let i = 0;
           typeTimer = setInterval(() => {
             rpgText.textContent += node.text.charAt(i); i++;
             if(i >= node.text.length) {
               clearInterval(typeTimer);
               showButtons();
             }
           }, 30);
      }
    }
 
    function openDialogue() {
      if(rpgDialogue.classList.contains('active')) return;
      rpgDialogue.classList.add('active');
      botContainer.classList.add('speaking');
      botContainer.classList.add('hint-removed'); 
      showDialogueNode('start');
    }
 
    function closeDialogue() {
      rpgDialogue.classList.remove('active');
      botContainer.classList.remove('speaking');
      setTimeout(() => { rpgText.textContent = ''; rpgOptions.innerHTML = ''; }, 300);
    }
 
    if(botContainer) {
      botContainer.addEventListener('click', (e) => {
        e.stopPropagation();
        if (idleInterval) {
            clearInterval(idleInterval);
            idleInterval = null;
        }
        if(botContainer.speechTimer) clearTimeout(botContainer.speechTimer); 
        botSpeech.textContent = "";                    
        botContainer.classList.remove('speaking'); 
        if(rpgDialogue.classList.contains('active')) closeDialogue();
        else openDialogue();
      });
    }
 
    setTimeout(() => {
         const guideText = currentLang === 'en' ? "Click me for guide!" : "ÁÇπÂáªÊàëÁ≠îÁñëËß£ÊÉë";
         botSay(guideText, 60000); 
    }, 1000);
 
    const badges = document.querySelectorAll('.nav-badges a');
    badges.forEach(b => {
      b.addEventListener('mouseenter', () => {
        document.body.classList.add('badge-hovering', 'hovering');
        if(vantaEffect) vantaEffect.setOptions({ color: 0x60a5fa });
        const accessText = currentLang === 'en' ? "Accessing..." : "Ê≠£Âú®ËÆøÈóÆ...";
        botSay(accessText, 1500);
      });
      b.addEventListener('mouseleave', () => {
        document.body.classList.remove('badge-hovering', 'hovering');
        if(vantaEffect) vantaEffect.setOptions({ color: 0x3b82f6 });
      });
      b.addEventListener('click', function(e) {
        e.preventDefault();
        const url = this.href;
        badges.forEach((sib, idx) => {
            const img = sib.querySelector('img');
            img.style.animationDelay = `${Math.abs(idx - [...badges].indexOf(this)) * 0.06}s`;
            img.classList.add('rippling');
        });
        setTimeout(() => window.location.href = url, 500);
      });
    });
 
  });
</script>
</body>
</html>
